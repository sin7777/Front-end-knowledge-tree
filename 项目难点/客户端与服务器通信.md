# 通信方式

## 短轮询

## 长轮询

## Http流

## 服务器发送事件

## WebSocket

[请看自己写的](../计算机网络/webSocket.md)

* 建立一个 WebSocket 连接，客户端浏览器首先要向服务器发起一个 HTTP 请求
* 这个请求和通常的 HTTP 请求不同，包含了一些附加头信息，其中附加头信息"Upgrade: WebSocket"表明这是一个申请协议升级的 HTTP 请求
* 服务器端解析这些附加的头信息然后产生应答信息返回给客户端，返回101
* WebSocket 连接建立
* 这个连接会持续存在直到客户端或者服务器端的某一方主动的关闭连接

### 协议的缺点

客户端

* 浏览器的兼容问题
* 场景是否真正需要？WebSocket 更加适用于直播的场景

服务器

* 长连接需要后端处理业务的代码更稳定（不要随便把进程和框架都crash掉）
* 推送消息相对复杂一些

基于多线程或多进程的服务器无法适用于 WebSockets，因为它旨在打开连接，尽可能快地处理请求，然后关闭连接。任何实际的 WebSockets 服务器端实现都需要一个异步服务器。

如果你的 web 应用使用了代理服务器 Nginx，那么你还需要为 Nginx 做一些配置，使得它开启 WebSocket 代理功能。

## 比较

### 服务器发送事件与 Web Sockets 比较

[服务器发送事件与 Web Sockets 比较](https://juejin.im/post/5a9a03ddf265da238f11fefb)

* 协议不同（Http与ws）
* 是否双工
* 兼容性

### http1.1 与 websocket 比较

[详细讲解](https://www.zhihu.com/question/20215561/answer/40316953)

* 协议不同，是否持久化
* websoket一个request，可以有多个response，http1.1一个request一个response
* 在讲Websocket之前，我就顺带着讲下 long poll 和 ajax轮询 的原理。

> 从上面很容易看出来，不管怎么样，上面这两种都是非常消耗资源的。
>
> ajax轮询 需要服务器有很快的处理速度和资源。（速度）
>
> long poll 需要有很高的并发，也就是说同时接待客户的能力。（场地大小）

* 缺点：浏览器兼容问题，安卓兼容问题，宽带和耗电量
* 断开：服务端发送0x8的控制帧给客户端
