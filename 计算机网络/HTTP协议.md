# HTTP 协议

> [讲解](https://segmentfault.com/a/1190000019891825)

超文本传输协议，属于应用层，应用进程间通信的准则

特点

* 无连接：交换HTTP报文之前，不需要建立HTTP连接
* 无状态：传输过程中，不保持任何历史信息
* 传输可靠性高：采用TCP作为传输层协议

## HTTP1.0

* 无连接、无状态的应用层信息
* 借助cookie/session机制来做身份认证和状态记录

缺点

* 浏览器与服务器只保持短暂连接，每个请求都需要与服务器建立一次TCP连接，导致性能比较低
* 队头阻塞，规定下一个请求必须要等亲一个请求响应到达之后才能发送

## HTTP1.1

* 默认开启 `Connection: Keep-Alive` 头部字段，表示建立 TCP 连接之后，并不会立刻断开 TCP 连接，而是保持这个状态，进而复用这个通道。
  * 那设置 Keep-Alive 之后什么时候回断开连接呢？正常情况下，应用层的进程一个请求发送完毕会主动关闭 TCP 连接，设置后 `Keep-Alive` 之后，进程在一个请求发送结束之后等待 `keep-alive timeout` 时间，如果这个时间内没有请求，再向传输层传递关闭TCP的信息
* 支持管道化，实现一定意义上的“并行”，把先进先出队列从客户端（请求队列）迁移至服务器端（响应队列）
* 仍然存在队头阻塞（浏览器厂商实际的实现是允许打开多个 TCP 会话窗口，实现真正的并行）

缺点

* 明文传输
* 无状态连接
* 多个请求被挂起的时候回拥塞请求通道，导致后面的请求无法发送
* 臃肿的消息首部，请求体内容可以被压缩，但是请求首部不能被压缩

## HTTP2.0

* 多路复用
  * 同一个域名下的请求都是一个 TCP 连接并发完成的，做到真正的并发请求
  * 多路复用与 `Keep-Alive` 的区别？ `Keep-Alive`仍然存在队头阻塞的问题，同一时间智能有一个请求在传输；多路复用可以同时传递多个请求，每个请求以 stream 的方式传输，每个 stream 有唯一标识， connection 一旦建立，后续的请求都可以复用这个 connection 并且可以同时发送，server 端可以根据 stream 的唯一标识来相应对应的请求。
* 流量控制
* 服务器端推送
  * 可以想象以下情况，某些资源客户端是一定会请求的
  * 当浏览器请求一个html时，服务器其实大概知道你是接下来要请求资源了，而不需要等待浏览器得到html后解析页面再发送资源请求。
* 首部压缩
  * 客户端服务器维护“首部表”来跟踪和存储之前发送的键-值对

## HTTPS

HTTP + 加密 + 认证 + 完整性保护 = HTTPS

HTTP 缺点

* 明文传输
* 无法确认通信方，很有可能被篡改

HTTPS 通信接口部分用 SSL（SecureSocket Layer）和 TLS（Transport Layer Security）协议代替

加密类型

* 对称加密：通信双方使用一个共同的密钥，AES 算法
* 非对称加密：有两把密钥，公钥和私钥，公钥用来加密，私钥用来自己解密

### HTTPS 的加密过程

> [参考](https://juejin.im/entry/5a9ac15bf265da239e4d8831)

非对称加密过程：

* 客户端访问服务器，访问时带上以下信息：
  * 随机生成随机数A
  * 支持的SSL版本号
  * 加密算法
* 服务器收到上面这些信息之后，确认双方的加密算法，也随机生成一个随机数B，给客户端回复以下信息
  * 随机数B
  * CA 证书
* 客户端收到证书之后，首先会验证CA证书的有效性，验证通过之后，会随机生成一个随机数C，然后用证书公钥中的加密随机数C传输给服务器
* 服务器得到加密之后的随机数C，用自己的私钥进行解密

对称加密过程

经过非对称加密之后客户端和服务器都有随机数A、B、C，利用三个随机数生成一个对话密钥，之后的传输就用对话密钥进行加密和解密

* 客户端通知服务器之后的通讯用对话密钥来完成，同时通知服务器握手结束
* 服务器通知客户端之后的通讯用对话密钥来完成，同时通知客户端握手结束
* SSL的握手结束，SSL 安全通道的数据通讯开始，客户端 A 和服务器 B 开始使用相同的对话密钥进行数据通讯。

HTTPS加密的缺点

* 消耗更多的 CPU 以及内存资源

## HTTP 与 HTTPS 的区别

* HTTP 协议不加密，HTTPS 采用加密的方式
* HTTP 默认使用80端口， HTTPS 默认使用443端口

## http & https & http2.0（之前写的）

### http请求的过程

> [详细讲解](https://zhuanlan.zhihu.com/p/37436528)
  
* 域名解析（是否有本地存储）
* 三次握手建立连接
* 浏览器就可以向服务器发送http 请求
* 服务器端接受到请求，根据路径参数，经过后端的一些处理之后返回相应的数据或页面
* 浏览器拿到资源对页面进行渲染

### http1.0的特点

* 设置参数才能有长链接（keep-alive参数）
* 不支持host域
* 明文传输
* 80端口

### Http1.1的特点

* HTTP1.1默认支持长连接
* 节约带宽——服务器返回401时客户端不再发送请求
* 支持host域

### Https的特点

* 需要到ca申请证书
* 具有安全性的ssl加密传输协议，身份认证的网络协议 要比http协议安全
* 443端口
* [为什么更加安全](https://zhuanlan.zhihu.com/p/22142170)

### Http2.0特点

* 性能有很大提升
* 多路复用
* 二进制分帧——应用层(HTTP/2)和传输层(TCP or UDP)之间增加一个二进制分帧层，HTTP/2 通过让所有数据流共用同一个连接，可以更有效地使用 TCP 连接（减少慢启动）
* 首部压缩
* 服务端推送——服务端推送是一种在客户端请求之前发送数据的机制，考虑浏览器缓存
