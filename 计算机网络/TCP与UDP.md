# TCP 与 UDP

## TCP与UDP的区别

* TCP面向连接，UDP无连接
* TCP传输可靠，UDP传输不可靠
* TCP传输效率慢，UDP传输效率快
* TCP首部字节20字节（20-60），UDP首部8个字节

## TCP

> [来源](https://www.jianshu.com/p/65605622234b)

传输控制协议，属于传输层的协议，基于TCP的应用层协议有HTTP、SMTP、FTP、Telnet 和 POP3

特点

* 面向连接：在传输数据之前必须建立TCP连接，结束之后断开连接
* 全双工通信：通讯双方都能收发数据
* 可靠协议：数据不丢失、无差错、不重复 & 按序到达
* 面向字节流

优缺点

* 优点：数据传输可靠
* 缺点：效率慢
  
报文段格式

* TCP 首部 + TCP 数据报部分

TCP首部（20字节）

* Sequence number，这个序号保证了 TCP 传输的报文都是有序的，对端可以通过序号顺序的拼接报文
* Acknowledgement Number，这个序号表示数据接收端期望接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到
* Window Size，窗口大小，表示还能接收多少字节的数据，用于流量控制
* 标识符
  * URG=1：该字段为一表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。
  * ACK=1：该字段为一表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为一。
  * PSH=1：该字段为一表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。
  * RST=1：该字段为一表示当前 TCP 连接出现严重问题，可能需要重新建立 TCP 连接，也可以用于拒绝非法的报文段和拒绝连接请求。
  * SYN=数字：
  * FIN=1：该字段为一表示此报文段是一个释放连接的请求报文。

## UDP

> [来源](https://juejin.im/post/5ad7e6c35188252ebd06acfa)

用户数据报协议，属于传输层的协议，基于UDP的应用层协议有 TFTP、SNMP 与 DNS

特点

* 无连接：不需要建立UDP连接
* 不可靠：数据报发送之后，不保证是否到达接收方
* 面向报文：以数据报的形式传输
* 无拥塞控制

优缺点

* 优点：速度快
* 缺点：消息容易丢失

报文段格式

* 首部 + 数据

UDP首部（8字节）

* 两个十六位的端口号，分别为源端口（可选字段）和目标端口
* 整个数据报文的长度（16位）
* 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误（16位）

UDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。

## 超时重传机制 ARQ协议

ARQ协议包括停止等待ARQ和连续ARQ

## 滑动窗口

## 拥塞控制

## 面向连接与无连接

面向连接服务的特点是其在进行数据传输前必须经过**建立连接、维护连接、释放连接三个过程**，并且在数据传输过程中，各分组不需要携带目的节点的地址。这就好比一个通信管道，数据发送方在一端发送数据，数据接收方在另一端取出数据。面向连接协议保证**数据传输的收发顺序不变**，即你应我答的模式。因此面向连接服务的**传输可靠性高**，但需要负担通信开始前的链接开销，协议复杂，通信效率不高。

在计算机网络中，面向连接协议除了Internet的传输控制协议（**TCP**，Transmission Control Protocol）以外，还有Novell的顺序分组交换（SPX）、IBM/Microsoft的NetBIOS等。

与面向连接相对，面向无连接是指通信双方**不需要事先建立通信线路**，而是把每个带有目的地址的报文分组送到线路上，由系统自主选定线路进行传输。

数据报是面向无连接网络的一个重要概念，可用于建立一个无连接的网络。

UDP通讯有四个参数：源IP、源端口、目的IP和目的端口。而TCP通讯至少有有六个参数：源IP、源端口、目的IP和目的端口，以及序列号和应答号。

因此对TCP连接的连接概念可以简单理解成为同UDP通讯相比，用序列号和应答号确定了相互之间的连接特征，来保证数据传输的正确性。

TCP使用了三种基础机制来实现面向连接的服务：

1. 使用序列号进行标记，以便TCP接收服务在向目的应用传递数据之前修正错序的报文排序；
2. TCP使用确认，校验，和定时器系统提供可靠性。
3. TCP在应用层数据上附加了一个报头，报头包括序列号字段和这些机制的其他一些必要信息，如叫做端口号的地址字段，该字段可以标识数据的源点和目标应用程序。
