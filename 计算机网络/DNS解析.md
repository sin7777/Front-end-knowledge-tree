# DNS 解析

DNS 的全称是domain name system，通过域名，最终得到该域名对应的IP地址的过程则是域名解析的过程。

DNS 查询分为两种

* 递归查询
* 迭代查询

解释域名：`www.baidu.com.`

* 根域： `.`
* 顶级域： `.com.` 或者其他（一共13种）
* 二级域： `baidu.com.`
* 子域：`www.baidu.com.`
* 主机名

## 递归查询

递归查询时如果客户端所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其他顶级域名服务器继续发出查询，直到查询到结果后，再层层传递回来

递归查询返回的是准确的 IP 地址

![递归查询](https://user-gold-cdn.xitu.io/2018/5/27/1639fd992859d5f1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

## 迭代查询

迭代查询中返回的是下一步查询的目标的 IP 地址

![迭代查询](https://user-gold-cdn.xitu.io/2018/5/27/1639fdb27f876e0d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

## DNS 解析中的缓存

在DNS查询过程中，客户端和服务器也都会加入缓存的机制，这样可以减少查询的次数，加快域名解析过程。当我们在浏览器中输入一个网站时，会发生如下过程

* 浏览器中输入想要访问的网站的域名，操作系统会先检查本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。
* 如果hosts里没有这个域名的映射，客户端会向本地DNS服务器发起查询。本地DNS服务器收到查询时，如果要查询的域名包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析。
* 如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置，采用递归或者迭代查询，直至解析完成。

## DNS 解析过程为什么采用 UDP

查询很频繁，使用UDP报文给服务器带来的负担小，所以查询的时候使用的是UDP报文，TCP 会的浪费很多的时间。

**DNS 会使用 TCP 协议进行传输吗？**

会！

DNS在进行区域传输的时候使用 TCP 协议，DNS 解析过程采用 UDP 协议

区域传送时使用TCP，主要有一下两点考虑：

1. 辅域名服务器会定时（一般时3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，则会执行一次区域传送，进行数据同步。区域传送将使用TCP而不是UDP，因为数据同步传送的数据量比一个请求和应答的数据量要多得多，UDP有大小限制，超过包的长度直接丢弃，TCP 可以分成几个包传输
2. TCP是一种可靠的连接，保证了数据的准确性。
